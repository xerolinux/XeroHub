---
const base = import.meta.env.BASE_URL.replace(/\/$/, '');
---
<!-- Crypto Donation Modal â€” iframe popup -->
<div id="crypto-modal" class="fixed inset-0 z-[9999] hidden items-center justify-center" data-base={base}>
  <!-- Backdrop -->
  <div id="crypto-backdrop" class="absolute inset-0 bg-black/70 backdrop-blur-sm"></div>

  <!-- Modal container -->
  <div class="relative w-full max-w-[960px] mx-4" style="max-height: 90vh;">
    <!-- Close button -->
    <button
      id="crypto-close"
      class="absolute -top-3 -right-3 z-10 w-9 h-9 rounded-full bg-[var(--color-bg-secondary)] border border-[var(--color-border)] text-[var(--color-text-secondary)] hover:text-white hover:border-[var(--color-border-hover)] transition-all duration-200 flex items-center justify-center cursor-pointer"
      aria-label="Close crypto modal"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>

    <!-- Iframe -->
    <iframe
      id="crypto-iframe"
      src=""
      class="w-full rounded-2xl border border-[var(--color-border)]"
      style="height: 85vh; max-height: 85vh;"
      loading="lazy"
      title="Crypto Donation Portal"
    ></iframe>
  </div>
</div>

<script is:inline>
  (function () {
    const modal = document.getElementById('crypto-modal');
    const backdrop = document.getElementById('crypto-backdrop');
    const closeBtn = document.getElementById('crypto-close');
    const iframe = document.getElementById('crypto-iframe');
    const base = modal?.getAttribute('data-base') || '';

    function openModal() {
      iframe.src = base + '/crypto.html';
      modal.classList.remove('hidden');
      modal.classList.add('flex');
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      modal.classList.add('hidden');
      modal.classList.remove('flex');
      document.body.style.overflow = '';
      iframe.src = '';
    }

    // Trigger: any element with data-crypto-modal
    document.querySelectorAll('[data-crypto-modal]').forEach(btn => {
      btn.addEventListener('click', openModal);
    });

    // Close on X click
    closeBtn?.addEventListener('click', closeModal);

    // Close on backdrop click
    backdrop?.addEventListener('click', closeModal);

    // Close on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
        closeModal();
      }
    });
  })();
</script>
