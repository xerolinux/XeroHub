---
import { getCollection } from 'astro:content';
import Layout from '../../components/layout/Layout.astro';
import UpdateCard from '../../components/ui/UpdateCard.astro';
import PageViews from '../../components/ui/PageViews.astro';

const allUpdates = await getCollection('updates', ({ data }) => !data.draft);
const sortedUpdates = allUpdates.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
const pageId = Astro.url.pathname.replace(/^\//, '').replace(/\/$/, '').replace(/\//g, '-') || 'home';
---

<Layout title="Updates" description="Project updates and announcements from XeroLinux.">
  <section class="pt-32 pb-20 px-4 sm:px-6 lg:px-8">
    <div class="mx-auto max-w-7xl">
      <!-- Header -->
      <div class="fade-in text-center mb-12">
        <h1 class="display-heading text-4xl sm:text-5xl text-[var(--color-text-primary)] mb-4">
          <span class="text-[var(--color-accent)]">Updates</span>
        </h1>
        <p class="text-[var(--color-text-secondary)] text-lg">
          Project announcements and changelog
        </p>
        <div class="flex justify-center mt-2">
          <PageViews pageId={pageId} />
        </div>
      </div>

      <!-- Updates Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {sortedUpdates.map((update, i) => (
          <div class={`fade-in fade-in-delay-${Math.min(i + 1, 4)}`}>
            <UpdateCard
              title={update.data.title}
              description={update.data.description}
              date={update.data.date}
              image={update.data.image}
              slug={update.id}
              body={update.body || ''}
            />
          </div>
        ))}
      </div>
    </div>
  </section>
</Layout>
